<!DOCTYPE html>
<html>
<head>
	<title>基础信息设置</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="plugins/jqgrid/ui.jqgrid-bootstrap.css">
	<link rel="stylesheet" href="css/main.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="css/all.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
	<!-- Theme style -->
<!--	<link rel="stylesheet" href="css/adminlte/adminlte.min.css">-->
	<!-- Google Font: Source Sans Pro -->
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
	<link rel="stylesheet" href="css/messenger.css">
	<link rel="stylesheet" href="css/messenger-theme-future.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<script src="libs/jquery.min.js"></script>
	<script src="libs/bootstrap.min.js"></script>
	<script src="plugins/jqgrid/grid.locale-cn.js"></script>
	<script src="plugins/jqgrid/jquery.jqGrid.min.js"></script>
	<script src="libs/vue.min.js"></script>
	<script src="libs/messenger.min.js"></script>
</head>
<body>
<div>
<form role="form">
	<div class="card card-warning">
		<div class="card-header">
			<h3 class="card-title">Code信息配置
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="edit1" type="button" class="btn btn-info btn-sm" onclick="edit(1)">编辑</button>
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="save1" type="button" class="btn btn-success btn-sm" onclick="save(1)">保存</button></h3>
		</div>
		<!-- Code信息配置 -->
		<div class="card-body">
				<div class="row">
					<div class="col-sm-6">
						<!-- text input -->
						<div class="form-group">
							<label>包名</label>
							<input type="text" id="packageInfo" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label>作者</label>
							<input type="text" id="author" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<!-- text input -->
						<div class="form-group">
							<label>Email</label>
							<input type="text" id="email" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label>表前缀</label>
							<input type="text" id="tablePrefix" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
				</div>
		</div>
	</div>

	<div class="card card-warning">
		<div class="card-header">
			<h3 class="card-title">数据源信息配置
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="edit2" type="button" class="btn btn-info btn-sm" onclick="edit(2)">编辑</button>
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="testConn" type="button" class="btn btn-primary btn-sm" onclick="test()">连接测试</button>
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="save2" type="button" class="btn btn-success btn-sm" onclick="save(2)">保存</button></h3>
		</div>
		<!-- 数据源设置 -->
		<div class="card-body">
				<div class="row">
					<div class="col-sm-6">
						<!-- text input -->
						<div class="form-group">
							<label>DataSourceType</label>
							<select id="dataSourceType" class="form-control" disabled>
								<option value="oracle">oracle</option>
								<option value="mysql">mysql</option>
							</select>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label>DriverClassName</label>
							<input id="driverClassName" type="text" class="form-control" placeholder="com.mysql.jdbc.Driver" readonly>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<!-- text input -->
						<div class="form-group">
							<label>Ip</label>
							<input id="dataSourceIp" type="text" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label>Port</label>
							<input id="dataSourcePort" type="text" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
							<label>UserName</label>
							<input id="username" type="text" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label>Password</label>
							<input id="password" type="password" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<!-- text input -->
						<div class="form-group">
							<label>DataSourceName</label>
							<input id="dataSourceName" type="text" class="form-control" placeholder="Enter ..." readonly>
						</div>
					</div>
				</div>
		</div>
	</div>

	<div class="card card-warning">
		<div class="card-header">
			<h3 class="card-title">自定义模板参数
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="edit3" type="button" class="btn btn-info btn-sm" onclick="edit(3)">编辑</button>
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="add" type="button" class="btn btn-primary btn-sm" onclick="addField()">新增</button>
				&nbsp;&nbsp;&nbsp;&nbsp;<button id="save3" type="button" class="btn btn-success btn-sm" onclick="delete(3)">删除</button></h3>
		</div>
		<div class="row"></div>
		<!-- 自定义模板参数 -->
		<div class="card-body p-0">
			<table id="extraFieldTable"></table>
			<div id="jqGridPager"></div>
		</div>
	</div>
</form>
</div>

<script type="text/javascript">
	$._messengerDefaults = { extraClasses: 'messenger-fixed messenger-theme-future messenger-on-top messenger-on-right' }
	$(document).ready(function(){
		$("#save1").hide();
		$("#save2").hide();
		$.get("/sys/generator/getGeneratorInfo",function (data, status) {
			var tmp = data.data;
			if (status == "success") {
				$("#author").val(tmp.author);
				$("#packageInfo").val(tmp.packageInfo);
				$("#email").val(tmp.email);
				$("#tablePrefix").val(tmp.tablePrefix);
			} else {
				$.globalMessenger().post({
					message: "查询基础信息失败",
					type: 'error',//消息类型。error、info、success
					showCloseButton: false,//是否显示关闭按钮
					hideOnNavigate: true
				});
			}
		});
		$.get("/sys/dataSource/getDataSourceInfo",function (data, status) {
			var tmp = data.data;
			if (status == "success") {
				$("#dataSourceType").val(tmp.dataSourceType);
				$("#driverClassName").val(tmp.driverClassName);
				$("#dataSourceIp").val(tmp.dataSourceIp);
				$("#dataSourcePort").val(tmp.dataSourcePort);
				$("#dataSourceName").val(tmp.dataSourceName);
				$("#username").val(tmp.username);
				$("#password").val(tmp.password);
			} else {
				$.globalMessenger().post({
					message: "查询数据源信息失败",
					type: 'error',//消息类型。error、info、success
					showCloseButton: false,//是否显示关闭按钮
					hideOnNavigate: true
				});
			}
		});
		$("#extraFieldTable").jqGrid({
			url: 'sys/generator/getExtraFields',
			datatype: "json",
			styleUI: "Bootstrap",
			height: 300,
			rownumbers: true,
			rownumWidth: 25,
			autowidth:true,
			colModel: [
				{ name: 'extraFieldType', sortable: false, index: 'extraFieldType', width: 50, editable: true, edittype: "select", editoptions: { value : "class:类;string:字符串" }},
				{ name: 'extraFieldName', sortable: false, index: 'extraFieldName', width: 60, editable: true, editoptions: { size : 60 }},
				{ name: 'extraFieldValue', sortable: false, index: 'extraFieldValue', width: 90, editable: true, editoptions: { size : 90 }}
			],
			jsonReader : {
				root: "data"
			},
			pager: "#jqGridPager",
			gridComplete:function(){
				//隐藏grid底部滚动条
				$("#extraFieldTable").closest(".ui-jqgrid-bdiv").css({ "overflow-x" : "hidden" });
			}
		});
	});
	function save(type) {
		if (type == 1) {
			save1();
		} else if (type == 2) {
			save2();
		}
	};
	function edit(type) {
		if (type == 1) {
			$("#author").removeAttr("readonly");
			$("#packageInfo").removeAttr("readonly");
			$("#email").removeAttr("readonly");
			$("#tablePrefix").removeAttr("readonly");
			$("#save1").show();
			$("#edit1").attr("disabled", "disabled");
		} else if (type == 2) {
			$("#dataSourceType").removeAttr("disabled");
			$("#driverClassName").removeAttr("readonly");
			$("#dataSourceIp").removeAttr("readonly");
			$("#dataSourcePort").removeAttr("readonly");
			$("#dataSourceName").removeAttr("readonly");
			$("#username").removeAttr("readonly");
			$("#password").removeAttr("readonly");
			$("#save2").show();
			$("#edit2").attr("disabled", "disabled");
		}
	};
	function save2() {
		$.ajax({
			type: "post",
			url: "/sys/dataSource/setDataSource",
			contentType: "application/json; charset=utf-8",
			data: JSON.stringify({
				"dataSourceType": $("#dataSourceType").val(),
				"driverClassName": $("#driverClassName").val(),
				"dataSourceIp": $("#dataSourceIp").val(),
				"dataSourcePort": $("#dataSourcePort").val(),
				"dataSourceName": $("#dataSourceName").val(),
				"username": $("#username").val(),
				"password": $("#password").val()
			}),
			dataType: "json",
			success: function (data) {
				if (data.code === 1) {
					$("#dataSourceType").attr("disabled", "disabled");
					$("#driverClassName").attr("readonly", "readonly");
					$("#dataSourceIp").attr("readonly", "readonly");
					$("#dataSourcePort").attr("readonly", "readonly");
					$("#dataSourceName").attr("readonly", "readonly");
					$("#username").attr("readonly", "readonly");
					$("#password").attr("readonly", "readonly");
					$("#save2").hide();
					$("#edit2").removeAttr("disabled");
					$.globalMessenger().post({
						message: "保存成功",
						type: 'success',//消息类型。error、info、success
						hideOnNavigate: true
					});
				} else {
					$.globalMessenger().post({
						message: data.message,
						type: 'error',//消息类型。error、info、success
						hideOnNavigate: true
					});
				}
			}
		});
	};
	function save1() {
		$.ajax({
			type: "post",
			url: "/sys/generator/saveGeneratorInfo",
			contentType: "application/json; charset=utf-8",
			data: JSON.stringify({
				"author": $("#author").val(),
				"packageInfo": $("#packageInfo").val(),
				"email": $("#email").val(),
				"tablePrefix": $("#tablePrefix").val()
			}),
			dataType: "json",
			success: function (data) {
				$("#author").attr("readonly", "readonly");
				$("#packageInfo").attr("readonly", "readonly");
				$("#email").attr("readonly", "readonly");
				$("#tablePrefix").attr("readonly", "readonly");
				$("#save1").hide();
				$("#edit1").removeAttr("disabled");
				$.globalMessenger().post({
					message: "保存成功",
					type: 'success',//消息类型。error、info、success
					hideOnNavigate: true
				});
			}
		});
	};
	function test() {
		$.ajax({
			type: "post",
			url: "/sys/dataSource/testDataSource",
			contentType: "application/json; charset=utf-8",
			data: JSON.stringify({
				"dataSourceType": $("#dataSourceType").val(),
				"driverClassName": $("#driverClassName").val(),
				"dataSourceIp": $("#dataSourceIp").val(),
				"dataSourcePort": $("#dataSourcePort").val(),
				"dataSourceName": $("#dataSourceName").val(),
				"username": $("#username").val(),
				"password": $("#password").val()
			}),
			dataType: "json",
			success: function (data) {
				if (data.code === 1) {
					$.globalMessenger().post({
						message: "连接成功",
						type: 'success',//消息类型。error、info、success
						hideOnNavigate: true
					});
				} else {
					$.globalMessenger().post({
						message: data.message,
						type: 'error',//消息类型。error、info、success
						hideOnNavigate: true
					});
				}
			}
		});
	};
	function addField() {
		var gr = jQuery("#delgrid").jqGrid('getGridParam', 'selrow');
		if (gr != null)
			jQuery("#delgrid").jqGrid('delGridRow', gr, {
				reloadAfterSubmit : false
			});
		else
			alert("Please Select Row to delete!");
	};
</script>
</body>
</html>